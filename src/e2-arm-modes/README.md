<!--
Copyright (c) 2020, 2024 Thomas Mikalsen. Subject to the MIT License 
-->
ARM Modes
=========

Experiment with changing ARM modes and SWI handlers
* supervisor -> User
* User -> Supervisor

Insert SD card into your development workstation, and run:
```
make install eject
```

Then insert the SD card it into your RPi 1 and start it up.



References
----------

https://developer.arm.com/documentation/dui0040/d/handling-processor-exceptions
https://developer.arm.com/documentation/dui0040/d/handling-processor-exceptions/swi-handlers
https://www.raspberrypi.org/forums/viewtopic.php?t=60277
https://stackoverflow.com/questions/8199609/arm-modes-user-and-system

https://developer.arm.com/documentation/dui0040/d/handling-processor-exceptions/entering-and-leaving-an-exception/the-return-address-and-return-instruction?lang=en

---
Returning from SWI and Undefined instruction

The SWI and Undefined instruction exceptions are generated by the instruction itself, so the program counter is not updated when the exception is taken. Therefore, storing (pc - 4) in lr_mode makes lr_mode point to the next instruction to be executed. Restoring the program counter from the lr with:

        MOVS            pc, lr

returns control from the handler.

The handler entry and exit code to stack the return address and pop it on return is:

        STMFD           sp!,{reglist,lr}
        ;...
        LDMFD           sp!,{reglist,pc}^
---